"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function a(o,u){try{var n=r[o](u),i=n.value}catch(e){return void t(e)}if(!n.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});e(i)}return a("next")})}}function applyRouter(e){var r=new _koaRouter2.default;return r.conf=(0,_conf.init)(__dirname),e.context.router=r,e.use(_routes2.default.redirectHtmlReq),e.use((0,_koaStatic2.default)(r.conf.staticDir)),r.get(_api2.default.index,_routes2.default.index),r.post(_api2.default.index,(0,_koaBody2.default)(),_routes2.default.adapterForBackwardComp),r.post(_api2.default.register,(0,_koaBody2.default)(),_routes2.default.register),r.post(_api2.default.startDebug,(0,_koaBody2.default)(),_routes2.default.startDebug),r.get(_api2.default.qrCode,_routes2.default.qrCode),r}var beforeStart=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_service.prepareStartServer)(t);case 2:return e.next=4,(0,_wsserver.createSocketServer)(r,t);case 4:a=(0,_service.serverConf)(t.context),t.context.adbDebugger=(0,_adb.createADBDebugger)({pathClientLog:a.defaults.pathClientLog,localReversePort:a.defaults.serverPort});case 6:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}(),_koaRouter=require("koa-router"),_koaRouter2=_interopRequireDefault(_koaRouter),_koaBody=require("koa-body"),_koaBody2=_interopRequireDefault(_koaBody),_koaStatic=require("koa-static"),_koaStatic2=_interopRequireDefault(_koaStatic),_conf=require("./lib/conf"),_api=require("./api"),_api2=_interopRequireDefault(_api),_routes=require("./routes"),_routes2=_interopRequireDefault(_routes),_service=require("./service"),_wsserver=require("./wsserver"),_adb=require("../adb");module.exports={applyRouter:applyRouter,beforeStart:beforeStart};